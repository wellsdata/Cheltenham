"0","master_index <- master_index |> "
"0","  mutate("
"0","    # Split name into parts"
"0","    name_parts = str_split(name, ""\\s+""),"
"0","    "
"0","    # Extract first name (always the first element)"
"0","    first_name = map_chr(name_parts, ~ .x[1]),"
"0","    "
"0","    # Extract middle and last name"
"0","    middle_name = map_chr(name_parts, function(parts) {"
"0","      if (length(parts) > 2) {"
"0","        # Check if last part is a suffix"
"0","        last_part <- parts[length(parts)]"
"0","        is_suffix <- str_detect(last_part, ""^(Jr\\.?|Sr\\.?|III?|IV|V)$"")"
"0","        "
"0","        if (is_suffix && length(parts) > 3) {"
"0","          # Middle name is everything between first and last two parts"
"0","          paste(parts[2:(length(parts) - 2)], collapse = "" "")"
"0","        } else if (!is_suffix) {"
"0","          # Middle name is everything between first and last part"
"0","          paste(parts[2:(length(parts) - 1)], collapse = "" "")"
"0","        } else {"
"0","          NA_character_"
"0","        }"
"0","      } else {"
"0","        NA_character_"
"0","      }"
"0","    }),"
"0","    "
"0","    # Extract last name (includes suffix if present)"
"0","    last_name = map_chr(name_parts, function(parts) {"
"0","      last_part <- parts[length(parts)]"
"0","      is_suffix <- str_detect(last_part, ""^(Jr\\.?|Sr\\.?|III?|IV|V)$"")"
"0","      "
"0","      if (is_suffix && length(parts) >= 2) {"
"0","        # Include both last name and suffix"
"0","        paste(parts[(length(parts) - 1):length(parts)], collapse = "" "")"
"0","      } else {"
"0","        last_part"
"0","      }"
"0","    })"
"0","  ) |> "
"0","  select(-name_parts)"
"0",""
"0",""
