---
title: "Cheltenham - Jessup PDF and processing"
author: "Rob Wells"
date: "2025-11-08"
output: html_document
---

For this exercise, you will create a PDFs of two Find a Grave websites, extract the data from the pdfs, clean it up and produce a single spreadsheet.

This task will use pdftools to extract the data and common data cleaning strategies to line it up

#Source: 
I created a pdf from this website of the results on Sept. 25, 2025  and extracted the data

https://www.findagrave.com/cemetery/2454348/memorial-search?firstname=&middlename=&lastname=&cemeteryName=Boy%27s+Village+of+Maryland+Cemetery&birthyear=&birthyearfilter=&deathyear=&deathyearfilter=&bio=&linkedToName=&plot=&memorialid=&mcid=&datefilter=&orderby=n&page=1#sr-250171171 


I created a second pdf from this website on Nov. 8, 2025
https://www.findagrave.com/virtual-cemetery/2005789?page=1#sr-157481048

HINT: When creating the PDFs, think of how you can minimize the noise in the document, such as skipping any images or by compressing the results into a tabular format.




# Load tidyverse, pdftools, rio, tidytext, knitr

```{r}


```


## Convert ONE PDF to text
```{r}
text <- pdf_text("LINK TO PDF")
#pdf_text reads the text from a PDF file.
writeLines(text, "graves.txt")
#writeLines writes this text to a text file
```


###Convert text into DF and clean

```{r}
index <- read_lines("graves.txt")

# Print the extracted lines to the console
cat(index, sep = "\n")

index <- index |> 
  as.data.frame() 
```

**Question:** Did all of the data load?

**Write Your Answer Here:**

### CLEAN TEXT
```{r}

simplified_df <- index |> 
  rename(name = index) |> 
  mutate(name = YOUR TEXT CLEANING SEQUENCE HERE
```

## Align the data

I will explain this complex code chunk. It is performing the following tasks:
1) Removing empty rows
2) Creating a helper column to identify if a row contains a date pattern
3) Creating the date column by looking at the next row for each name
```{r}

# Create a new dataframe with names and dates properly aligned

graves_df <- simplified_df |>
  # Remove empty rows
  filter(!is.na(name) & name != "") |>
  # Create a helper column to identify if a row contains a date pattern
  mutate(
     is_date = grepl("\\d{1,4}\\s*(–|-)", name) | grepl("unknown", name),
    row_num = row_number()
  ) |>
  # Create the date column by looking at the next row for each name
  mutate(
    date = case_when(
      !is_date & lead(is_date) ~ lead(name),  # If current row is name and next row is date
      TRUE ~ NA_character_
    )
  ) |>
  # Keep only the name rows (not the date rows)
  filter(!is_date) |> 
  # Clean up
  select(name, date) |>
  # Remove any remaining rows where name or date is missing
  filter(!is.na(date))
```



# Further Clean Names and remove numbers and stray characters
```{r}
graves_df <- graves_df |> 
  mutate(name = YOUR DATA CLEANING HERE
```



### Create birth and death columns
Separate based on the - character into two new columns
```{r}
graves_df1 <- separate(data = graves_df, 
                       col = date, 
                       into = c("birth_date", "death_date"), 
                       sep = "–",  # en dash, not regular hyphen
                       extra = "merge", 
                       fill = "right")
```


### Create Birth and Death years
```{r}

graves_df1 <- graves_df1 |> 
  mutate(birth_year = YOUR CODE HERE

#write.csv(graves_df1, "cheltenham_deaths_9_25_2025.csv")
write.csv(graves_df1, "XXXXX")
```


#statistics
```{r}
summary(graves_df1$approx_age)

# The youngest died at about age 9 and the oldest at age 21. The average age was 15.6 years and the median was age 16
```



## Graph of age
```{r}
graves_df1 |> 
  group_by(approx_age) |> 
  summarise(total = n()) |> 
ggplot(aes(x = approx_age, y = total, fill = total)) +
  geom_col(position = "dodge") +
  theme(legend.position = "none") +
  scale_x_continuous(breaks=c(9:21)) +
  labs(title = "Ages of Cheltenham youth deaths",
       subtitle = "From 1880-1939, Approximate Ages",
       caption = "Graphic by Rob Wells, 9-25-2023",
       y="Number",
       x="Approximate Ages")


```


